![img](https://github.com/hackthebox/writeup-templates/raw/master/challenge/assets/images/banner.png)

<img src="https://github.com/hackthebox/writeup-templates/raw/master/challenge/assets/images/htb.png" style="margin-left: 20px; zoom: 80%;" align=left />  <font size='20'>Enchanted Cipher</font>

18<sup>th</sup> March 2025

**Prepared By:** xclow3n  
**Challenge Author(s):** makelaris
**Difficulty:** Easy  
**Classification:** Official

---

## Challenge Story and Objective

In this challenge, you are given an encoded message produced by an enchanted shifting cipher. The original plaintext consists of 3â€“7 randomly generated words, and the encryption process involves the following steps:

- **Grouping Characters:**  
  The plaintext is stripped of spaces and punctuation, and its alphabetical characters are grouped into segments of 5.
  
- **Shifting Letters:**  
  For each group, every letter is shifted by a random value between 1 and 25 (similar to a Caesar cipher). When a group ends, a new random shift is applied to the next group of 5 characters.
  
After the encoded message, two additional lines are provided:
1. The total number of shift groups applied.
2. A list of the random shift values used for each group.

**Your Task:**  
You must decode the encoded message by reversing the shifting process and restoring the original plaintext.

---

## Input Format Explanation

The input consists of three parts provided on separate lines:

1. **Encoded Message:**  
   A string that represents the encoded text. This text includes spaces and punctuation, which should be preserved during decryption.
   
2. **Number of Shift Groups:**  
   An integer indicating how many groups of shifts were applied to the message.
   
3. **Shift Values:**  
   A list (in string format) containing the random shift values used for each group. For example: `[4, 7]`

**Example Input:**

```
ibeqtsl
2
[4, 7]
```

- **Encoded Message:** `"ibeqtsl"`
- **Number of Shift Groups:** `2`
- **Shift Values:** `[4, 7]`

In this example, the encoded message was generated by applying a shift of 4 to the first group (first 5 alphabetical characters) and a shift of 7 to the next group.

---

## Example Walkthrough

Given the example input above:

- **Encoded Message:** `"ibeqtsl"`
- **Shift Groups:** 2  
- **Shifts:** `[4, 7]`

**Decryption Process:**

1. **Grouping:**  
   The alphabetical characters are processed in order. They are grouped in blocks of 5 (ignoring any non-alphabetical characters). In this example, since there are 7 characters, the first 5 are decrypted with a shift of 4 and the remaining 2 with a shift of 7.
   
2. **Decryption:**  
   Each letter in a group is shifted backward by its group's shift value (using modulo arithmetic for wrap-around).
   
   The final decrypted text becomes `"example"`.

**Expected Output:**

```
example
```

---

## Detailed Explanation of the Solution

### Approach

To decode the message, the solution follows these steps:

1. **Input Parsing:**
   - Read the encoded text.
   - Read the number of shift groups (although this information isn't directly used in decryption since the shifts list defines the groups).
   - Convert the string representation of the shift list into a Python list using `ast.literal_eval`.

2. **Decryption Function:**
   - Define a helper function `decrypt_char(ch, shift)` that reverses the encryption of a single character. This function:
     - Checks if the character is lowercase or uppercase.
     - Applies the reverse shift using modulo arithmetic to ensure the result wraps around the alphabet.

3. **Processing the Message:**
   - Iterate over each character in the encoded message.
   - If the character is alphabetical, determine its group based on its order (groups of 5 characters).
   - Apply the corresponding shift from the shift list and append the decrypted character to the result.
   - Non-alphabetical characters are preserved as they are.

4. **Output:**
   - Print the fully decrypted message.

### Code Walkthrough

Below is the complete solution code:

```python
import ast

encoded_text = input().rstrip("\n")
num_groups = int(input().strip())
shifts = ast.literal_eval(input().strip())

def decrypt_char(ch, shift):
    if ch.islower():
        return chr((ord(ch) - ord('a') - shift) % 26 + ord('a'))
    elif ch.isupper():
        return chr((ord(ch) - ord('A') - shift) % 26 + ord('A'))
    else:
        return ch

result = ""
alpha_count = 0

for ch in encoded_text:
    if ch.isalpha():
        group_index = alpha_count // 5
        shift_value = shifts[group_index]
        result += decrypt_char(ch, shift_value)
        alpha_count += 1
    else:
        result += ch

print(result)
```